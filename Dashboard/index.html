<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Admin Dashboard</title>

    <!-- Montserrat Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <link rel="shortcut icon" href="/ico/favicon.ico" type="image/x-icon">
  </head>
  <style>

    
    
    h1 {
        text-align: center;
    }

    table {
        width: 100%; min-width: fit-content;
        min-height: fit-content;
        margin: 0 auto;
        border-collapse: collapse;
        background-color: #00000098;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 35px;
        border: none;
        padding: 10px;
    }

    td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: center;
    }

    th {
        background-color: #ffffffa9;
        color: #303030;
        height: 40px;
    }

    tr:nth-child(even) {
        background-color: #00000092;
        border-radius: 20px;
        border: none;
    }

    .popContainer{
    width: 100%;
    height: 120vh;
    background-color: #adadadbc;
    /* background-image: url(images/Background/pic1.jpg); */
    /* filter: blur(8px);  */
    display: flex;
    align-items: center;
    justify-content: center;
}

.popup{
    width: 100%;
    height: 100%;
    background-color: #1f1e1e;
    border-radius: 6px;
    position: absolute;
    top: 0%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.1);
    text-align: center;
    padding: 79px 30px 30px;
    color: #fcfcfc;
    visibility: hidden;
    transition: transform 0.4s, top 0.4s;
}

.open-popup{
    visibility: visible;
    top: 50%;
    transform: translate(-50%, -50%) scale(1);
    /* filter: blur(8px); */
}

.popup img{

    width:100px;
    margin-top: -50px;
    border-radius: 50%;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.089);
}

.popup button{
    width: 100%;
    margin-top: 50px;
    padding: 10px 0;
    background-color: #ad9924;
    outline: none;
    font-size: 18px;
    border-radius: 18px;
    border: 0;
    box-shadow: 0 5px 5px rgba(0,0,0,0.2);
}

</style>
  <body>
    <div class="grid-container">
      <div class="popup" id="popup">
        <img src="images/tick.png" alt="">
        <h2>Log Out confirmation!</h2>

        <form action="/SignUp_page.html">
            <button type="submit">Yes</button>
        </form>
        
        <form action="/Dashboard/index.html">
            <button type="submit">No</button>
        </form>

    </div>

      <!-- Header -->
      
      <!-- End Header -->

      <!-- Sidebar -->
      
      <!-- End Sidebar -->

      <!-- Main -->
      <main class="main-container">


        <nav>

          <div class="logo">
              <p>IT EASY</p>
          </div>
  
              <ul class="nav_list">
                  <li><a href="/Rooms.html">Room</a></li> 
                  <li><a href="">Dash Board</a></li> 
                  <li><a href="/info.html">Info</a></li> 
                  <button type="submit" class="btn" onclick="openPopup()">Log Out</button> 
              </ul>
                      
      </nav>

        <div class="main-title">
          <h2><a href="/Rooms.html" style="color: white; text-decoration: none;">HOME SPACE</a></h2>
        </div>

        <div class="main-cards">

          

          <div class="card">
            <div class="card-inner">
              <h3>Total Powerusage</h3>
              <span class="material-icons-outlined">inventory_2</span>
            </div>
            <p id="counter">Offline</p>
          </div>
          

          <div class="card">
            <div class="card-inner">
              <h3>Appliance: Light</h3>
              <span class="material-icons-outlined">inventory_2</span>
            </div>
            <p id="counter1">Offline</p>
          </div>

          <div class="card">
            <div class="card-inner">
              <h3>Appliance: Lights</h3>
              <span class="material-icons-outlined">groups</span>
            </div>
            <p id="counter2">Offline</p>
          </div>

          <div class="card">
            <div class="card-inner">
              <h3>Appliance: Fan</h3>
              <span class="material-icons-outlined">notification_important</span>
            </div>
            <p id="counter_4">Offline</p>
          </div>

        </div>

        <h1>White River Loadshedding Schedule</h1>
    <table>
        <tr>
            <th>Day</th>
            <th>Start Time</th>
            <th>End Time</th>
        </tr>
        <tr>
            <td>Monday</td>
            <td>09:00</td>
            <td>11:00</td>
        </tr>
        <tr>
            <td>Tuesday</td>
            <td>10:00</td>
            <td>13:00</td>
        </tr>
        <tr>
            <td>Wednesday</td>
            <td>06:00</td>
            <td>09:00</td>
        </tr>
        <tr>
            <td>Thursday</td>
            <td>10:00</td>
            <td>13:00</td>
        </tr>
        <tr>
            <td>Friday</td>
            <td>09:00</td>
            <td>11:00</td>
        </tr>
        <tr>
            <td>Saturday</td>
            <td>10:00</td>
            <td>14:00</td>
        </tr>
        <tr>
            <td>Sunday</td>
            <td>06:00</td>
            <td>13:00</td>
        </tr>
    </table>

        <div class="charts">

          <div class="charts-card">
            <h2 class="chart-title">Appliances Power Usage</h2>
            <div id="bar-chart"></div>
          </div>

          

        </div>

        
      </main>
      <!-- End Main -->

    </div>

    <!-- Scripts -->
    <!-- ApexCharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.35.5/apexcharts.min.js"></script>
    <!-- Custom JS -->
    <script src="js/scripts.js"></script>
    <script>
      let popup = document.getElementById("popup");

      function openPopup(){
          popup.classList.add("open-popup");
      }
      function closePopup(){
          popup.classList.remove("open-popup");
      }

  </script>
  </body>


<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script type="module">
    // script.js (as an ES6 module)

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBCj46mc4a_Q16K_IugcdRhE--UwLgv3Ug",
      authDomain: "authentication-app-b028b.firebaseapp.com",
        databaseURL: "https://authentication-app-b028b-default-rtdb.firebaseio.com",
        projectId: "authentication-app-b028b",
        storageBucket: "authentication-app-b028b.appspot.com",
        messagingSenderId: "1085046599528",
        appId: "1:1085046599528:web:fc65a4072f511d948030dd"
    };


  const firebaseApp = initializeApp(firebaseConfig);

  // Get a reference to the Firebase Realtime Database
  const database = getDatabase(firebaseApp);

  const roomName = "Kitchen"; // Change this to the room you want to track

  // Get the last saved count value from Firebase
  const roomRef = ref(database, `users/Powerusage per Room/${roomName}`);
  get(roomRef)
      .then((snapshot) => {
          if (snapshot.exists()) {
              const roomData = snapshot.val();
              const count = roomData.Lights; // Retrieve the Lights count
              // Update the HTML element with the retrieved count
              const counterElement = document.getElementById("counter");
              const counterElement2 = document.getElementById("counter2");
              const counterElement1 = document.getElementById("counter1");
              if (counterElement) {
                  counterElement.textContent = ` ${count} kW`;
                  counterElement2.textContent = ` ${count} kW`;
                  counterElement1.textContent = ` ${count/60} Hours`;
              }
          } else {
              console.log(`No data found for ${roomName}`);
          }
          
      })
      .catch((error) => {
          console.error("Error getting data:", error);
      });

      function updateCountInHTML(count) {
  $("#counter2").text("Count: " + count);
}

// ...

// Inside the event listener for "power" location in the database
database.ref("power").on("value", function (snap) {
  powerValue = snap.val() || 0;
  $("#power").text(powerValue);

  // Update the count in the HTML when the power value changes
  updateCountInHTML(powerValue);
});


</script>
 <script>
  function updatePageContent() {
    $.ajax({
        url: 'update-data.php', // Replace with the URL of your server-side script
        type: 'GET',
        success: function(data) {
            // Replace the entire content of the page with the updated data
            $('body').html(data);

            // Schedule the next update
            setTimeout(updatePageContent, 1000); // Update every 1 second (you can adjust the interval)
        },
        error: function() {
            console.error('Failed to fetch updated data.');
        }
    });
}

// Start the real-time updating process when the page loads
$(document).ready(updatePageContent);

 </script>


</html>